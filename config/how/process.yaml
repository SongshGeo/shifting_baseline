# 将原始数据进行处理，并保存到本地
name: "数据预处理"

# 输入原始数据目录
input: "${ds.cmip6}"
# CMIP6 数据存储的子目录模式
subdir_pattern: "{freq}/{model}"

# 输出目录：根目录下的 data 文件夹
output: "${ds.root}/data"

# 裁剪范围：黄河流域矢量图
shp: ${ds.data}/黄河流域矢量图/空间范围/huai_hai.shp  # 仅仅裁剪黄河下游
# shp: ${ds.data}/黄河流域矢量图/空间范围/huang_huai_hai_merged.shp  # 裁剪黄河全流域

# 自然重建数据
recon:
  # 黄河径流量
  yellow2019flow:
    path: ${ds.noaa}/yellowriverflow2019/yellow2019flow.txt
    type: csv
    process:
      read_csv:
        skiprows: 104
        sep: '\t'
        names: ['year', 'streamflow']
    out: ${how.output}/recon/yellow2019flow.csv

  # 降水
  shi2018:
    path: ${ds.noaa}/shi2018/RAP_v1.nc
    type: grid
    process:
      open_dataarray:
        decode_times: False
      clip_data:
        shp: ${how.shp}
      convert_time_axis:
        begin_year: 1470
    out: ${how.output}/recon/shi2018.nc
    variable: 'pr'

# 处理流程
pipeline:
  # 数据处理
  - batch_process_and_save_by_config
  - batch_process_recon_data
